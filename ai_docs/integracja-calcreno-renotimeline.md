# Integracja CalcReno ‚Üî RenoTimeline - Ecosystem Powiadomie≈Ñ

## üéØ Nowa Wizja: Ecosystem Powiadomie≈Ñ

Twoje podej≈õcie jest znacznie bardziej praktyczne i realistyczne. Zamiast skomplikowanej synchronizacji danych, skupiamy siƒô na inteligentnej komunikacji miƒôdzy aplikacjami poprzez zaawansowany system powiadomie≈Ñ.

**üèóÔ∏è FUNDAMENT: CalcReno ‚Üí Supabase Integration MUSI byƒá pierwsze!**
Ca≈Çy ecosystem wymaga shared authentication i cloud-based project IDs.

## üì± Obecny Stan CalcReno

### Aktualna Architektura:
- **React Native + Expo** - mobile-first aplikacja
- **AsyncStorage** - lokalne przechowywanie danych projekt√≥w
- **TypeScript** - type safety w ca≈Çej aplikacji
- **NativeWind + Tailwind** - styling system

### Aktualne Struktury Danych:
```typescript
interface Project {
  id: string;
  name: string;
  status: "W trakcie" | "Planowany" | "Zako≈Ñczony" | "Wstrzymany";
  startDate: string;
  endDate: string;
  isPinned: boolean;
  description?: string;
  rooms: Room[];
  totalCost?: number;
}

interface Room {
  id: string;
  name: string;
  shape: "rectangle" | "l-shape";
  dimensions: { width: number; length: number; height: number; };
  elements: RoomElement[]; // doors, windows
  materials?: MaterialCalculation;
}
```

### Obecne Funkcjonalno≈õci:
- ‚úÖ Tworzenie i zarzƒÖdzanie projektami
- ‚úÖ Kalkulacja koszt√≥w materia≈Ç√≥w
- ‚úÖ Geometria pomieszcze≈Ñ (prostokƒÖt + L-shape)
- ‚úÖ Eksport PDF z kosztorysami
- ‚úÖ Local storage management

### Potrzebne Zmiany dla Integracji:
- üîÑ **Migracja z AsyncStorage na Supabase** (cloud storage)
- üîÑ **Dodanie systemu autentykacji** (shared z RenoTimeline)
- üîÑ **Cross-app notifications API**
- üîÑ **Project linking/export functionality**

## üìä Uproszczone Mapowanie Danych

### CalcReno -> RenoTimeline (Minimal Transfer):

**Podstawowe Dane Projektu:**
- Nazwa projektu ‚Üí Project title w RenoTimeline
- Data utworzenia ‚Üí Project creation date
- Podstawowy opis/adres ‚Üí Project description
- ID projektu CalcReno ‚Üí Reference link (≈ºeby wiedzieƒá skƒÖd pochodzi)

**Szacowany bud≈ºet ca≈Çkowity ‚Üí** Project budget field (opcjonalny)

**I to wszystko! Dane p≈ÇynƒÖ TYLKO w jednƒÖ stronƒô: CalcReno ‚Üí RenoTimeline.**
**Nie ma sensu synchronizowaƒá pokoi, materia≈Ç√≥w, zada≈Ñ - to r√≥≈ºne domeny.**

### Dlaczego Tylko Jedna Strona:
- **CalcReno = Source of Truth** dla projekt√≥w (tam siƒô tworzy projekt, bud≈ºet, podstawowe dane)
- **RenoTimeline = Execution Tool** (harmonogram, zadania, timeline na podstawie projektu z CalcReno)
- **No data back** - RenoTimeline nie tworzy projekt√≥w, tylko zarzƒÖdza timeline dla istniejƒÖcych

## üíº Business Value Proposition

### Dla U≈ºytkownik√≥w:
- **Proactive Management** - dowiadujƒÖ siƒô o problemach zanim siƒô nasilƒÖ
- **Data-Driven Decisions** - decyzje na podstawie real-time data z obu aplikacji
- **Professional Image** - klienci widzƒÖ, ≈ºe wszystko jest pod kontrolƒÖ
- **Viral Growth** - users polecajƒÖ combo CalcReno + RenoTimeline

### Dla Biznesu:
- **User Retention** - trudno odej≈õƒá gdy masz insights z obu aplikacji
- **Premium Features** - advanced AI insights jako paid feature
- **Market Positioning** - jedyny tak ecosystem na rynku
- **Data Monetization** - czyste monetyzacja path

## üöÄ Roadmap Implementacji

## üèóÔ∏è Etap Przygotowawczy: CalcReno ‚Üí Supabase Integration (FUNDAMENT)

### üéØ Cel Etapu:
**Migracja CalcReno z AsyncStorage na Supabase - stworzenie fundamentu dla ca≈Çego ecosystem.**

### üîë Dlaczego To Musi Byƒá Pierwsze:
- **Shared Authentication** - jeden account dla obu aplikacji
- **Cloud-Based Projects** - projekty dostƒôpne z ka≈ºdego urzƒÖdzenia  
- **Persistent Project IDs** - stable references dla cross-app linking
- **Real-time Foundation** - infrastructure dla notifications
- **User Email Addresses** - potrzebne dla email notifications

### üìã Zakres Prac:

#### 0.1 **Supabase Client Setup w CalcReno**
- **Install @supabase/supabase-js** w React Native app
- **Environment variables** - connection do twojego istniejƒÖcego Supabase
- **Auth configuration** - shared auth z RenoTimeline
- **Offline-first architecture** - AsyncStorage jako cache, Supabase jako source of truth

**CalcReno Implementation Details:**
```bash
# Dodaƒá dependencje do package.json
npm install @supabase/supabase-js
```

```typescript
// app/utils/supabase.ts - nowy plik
import { createClient } from '@supabase/supabase-js';
import AsyncStorage from '@react-native-async-storage/async-storage';

const supabaseUrl = process.env.EXPO_PUBLIC_SUPABASE_URL!;
const supabaseAnonKey = process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY!;

export const supabase = createClient(supabaseUrl, supabaseAnonKey, {
  auth: {
    storage: AsyncStorage,
    autoRefreshToken: true,
    persistSession: true,
    detectSessionInUrl: false,
  },
});
```

#### 0.2 **Authentication Integration**
- **Login/Register screens** w CalcReno
- **Shared user accounts** - same auth system jak RenoTimeline
- **Auto-migration prompt** - existing local projects ‚Üí cloud
- **Guest mode fallback** - optional dla users kt√≥rzy nie chcƒÖ account

**CalcReno Implementation Details:**
```typescript
// app/auth/AuthScreen.tsx - nowy komponent
import { useState } from 'react';
import { View, Text, TextInput, Pressable } from 'react-native';
import { supabase } from '../utils/supabase';

export function AuthScreen() {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [isLogin, setIsLogin] = useState(true);

  const handleAuth = async () => {
    const { error } = isLogin 
      ? await supabase.auth.signInWithPassword({ email, password })
      : await supabase.auth.signUp({ email, password });
    
    if (error) console.error('Auth error:', error.message);
  };

  return (
    <View className="flex-1 justify-center p-6">
      <Text className="text-2xl font-bold mb-6 text-center">
        {isLogin ? 'Zaloguj siƒô' : 'Utw√≥rz konto'}
      </Text>
      
      <TextInput
        className="border border-gray-300 rounded p-3 mb-4"
        placeholder="Email"
        value={email}
        onChangeText={setEmail}
        keyboardType="email-address"
      />
      
      <TextInput
        className="border border-gray-300 rounded p-3 mb-4"
        placeholder="Has≈Ço"
        value={password}
        onChangeText={setPassword}
        secureTextEntry
      />
      
      <Pressable
        className="bg-blue-500 rounded p-3 mb-4"
        onPress={handleAuth}
      >
        <Text className="text-white text-center font-semibold">
          {isLogin ? 'Zaloguj' : 'Zarejestruj'}
        </Text>
      </Pressable>
    </View>
  );
}
```

```typescript
// app/hooks/useAuth.tsx - nowy hook
import { useState, useEffect } from 'react';
import { supabase } from '../utils/supabase';
import type { User } from '@supabase/supabase-js';

export function useAuth() {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // Get initial session
    supabase.auth.getSession().then(({ data: { session } }) => {
      setUser(session?.user ?? null);
      setLoading(false);
    });

    // Listen for auth changes
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      (_event, session) => {
        setUser(session?.user ?? null);
        setLoading(false);
      }
    );

    return () => subscription.unsubscribe();
  }, []);

  return { user, loading };
}
```

#### 0.3 **Database Schema dla CalcReno**
```sql
-- CalcReno-specific tables w twojej istniejƒÖcej Supabase
CREATE TABLE calcreno_projects (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id uuid REFERENCES auth.users(id),
  name text NOT NULL,
  description text,
  status text CHECK (status IN ('W trakcie', 'Planowany', 'Zako≈Ñczony', 'Wstrzymany')),
  start_date date,
  end_date date,
  is_pinned boolean DEFAULT false,
  total_cost decimal,
  created_at timestamp DEFAULT now(),
  updated_at timestamp DEFAULT now()
);

CREATE TABLE calcreno_rooms (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  project_id uuid REFERENCES calcreno_projects(id) ON DELETE CASCADE,
  name text NOT NULL,
  shape text CHECK (shape IN ('rectangle', 'l-shape')),
  dimensions jsonb NOT NULL,
  corner text,
  created_at timestamp DEFAULT now()
);

CREATE TABLE calcreno_room_elements (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  room_id uuid REFERENCES calcreno_rooms(id) ON DELETE CASCADE,
  type text CHECK (type IN ('door', 'window')),
  width decimal NOT NULL,
  height decimal NOT NULL,
  position decimal NOT NULL,
  wall integer NOT NULL
);

-- RLS Policies
ALTER TABLE calcreno_projects ENABLE ROW LEVEL SECURITY;
ALTER TABLE calcreno_rooms ENABLE ROW LEVEL SECURITY;
ALTER TABLE calcreno_room_elements ENABLE ROW LEVEL SECURITY;
```

#### 0.4 **Data Migration System**
- **AsyncStorage ‚Üí Supabase migration** one-time process
- **Data preservation** - zero data loss during migration
- **Rollback capability** - safety net if migration fails
- **Progress indicator** - user sees migration progress

**CalcReno Implementation Details:**
```typescript
// app/utils/migration.ts - nowy plik
import { StorageService } from './storage';
import { supabase } from './supabase';

export class DataMigrationService {
  static async migrateToSupabase(userId: string, onProgress?: (step: string, progress: number) => void) {
    try {
      onProgress?.('Pobieranie lokalnych projekt√≥w...', 10);
      
      // 1. Pobranie wszystkich lokalnych projekt√≥w
      const localProjects = await StorageService.getProjects();
      
      if (localProjects.length === 0) {
        onProgress?.('Brak projekt√≥w do migracji', 100);
        return { success: true, migrated: 0 };
      }

      onProgress?.('Przygotowanie danych...', 30);
      
      // 2. Konwersja lokalnych projekt√≥w na format Supabase
      const migratedCount = localProjects.length;
      
      for (let i = 0; i < localProjects.length; i++) {
        const project = localProjects[i];
        
        onProgress?.(`Migracja projektu ${i + 1}/${localProjects.length}...`, 
          30 + (i / localProjects.length) * 60);

        // 3. Zapis projektu do Supabase
        const { error: projectError } = await supabase
          .from('calcreno_projects')
          .insert({
            id: project.id,
            user_id: userId,
            name: project.name,
            description: project.description,
            status: project.status,
            start_date: project.startDate,
            end_date: project.endDate,
            is_pinned: project.isPinned,
            total_cost: project.totalCost,
          });

        if (projectError) throw projectError;

        // 4. Migracja pomieszcze≈Ñ
        for (const room of project.rooms) {
          const { error: roomError } = await supabase
            .from('calcreno_rooms')
            .insert({
              id: room.id,
              project_id: project.id,
              name: room.name,
              shape: room.shape,
              dimensions: room.dimensions,
              corner: room.corner,
            });

          if (roomError) throw roomError;

          // 5. Migracja element√≥w pomieszczenia
          for (const element of room.elements) {
            const { error: elementError } = await supabase
              .from('calcreno_room_elements')
              .insert({
                id: element.id,
                room_id: room.id,
                type: element.type,
                width: element.width,
                height: element.height,
                position: element.position,
                wall: element.wall,
              });

            if (elementError) throw elementError;
          }
        }
      }

      onProgress?.('Finalizacja migracji...', 95);
      
      // 6. Oznaczenie migracji jako zako≈Ñczonej
      await AsyncStorage.setItem('calcreno_migrated', 'true');
      
      onProgress?.('Migracja zako≈Ñczona!', 100);
      
      return { success: true, migrated: migratedCount };
      
    } catch (error) {
      console.error('Migration failed:', error);
      return { success: false, error };
    }
  }

  static async checkMigrationStatus(): Promise<boolean> {
    try {
      const migrated = await AsyncStorage.getItem('calcreno_migrated');
      return migrated === 'true';
    } catch {
      return false;
    }
  }
}
```

```typescript
// app/components/MigrationScreen.tsx - nowy komponent
import { useState } from 'react';
import { View, Text, Pressable } from 'react-native';
import { DataMigrationService } from '../utils/migration';
import { useAuth } from '../hooks/useAuth';

export function MigrationScreen({ onComplete }: { onComplete: () => void }) {
  const { user } = useAuth();
  const [migrating, setMigrating] = useState(false);
  const [progress, setProgress] = useState(0);
  const [step, setStep] = useState('');

  const handleMigration = async () => {
    if (!user) return;
    
    setMigrating(true);
    
    const result = await DataMigrationService.migrateToSupabase(
      user.id,
      (step, progress) => {
        setStep(step);
        setProgress(progress);
      }
    );

    if (result.success) {
      onComplete();
    }
    
    setMigrating(false);
  };

  return (
    <View className="flex-1 justify-center p-6">
      <Text className="text-xl font-bold mb-4 text-center">
        Migracja Danych do Chmury
      </Text>
      
      {migrating ? (
        <View>
          <Text className="text-center mb-4">{step}</Text>
          <View className="w-full bg-gray-200 rounded-full h-2">
            <View 
              className="bg-blue-500 h-2 rounded-full"
              style={{ width: `${progress}%` }}
            />
          </View>
          <Text className="text-center mt-2">{progress}%</Text>
        </View>
      ) : (
        <Pressable
          className="bg-green-500 rounded p-4"
          onPress={handleMigration}
        >
          <Text className="text-white text-center font-semibold">
            Rozpocznij Migracjƒô
          </Text>
        </Pressable>
      )}
    </View>
  );
}
```

#### 0.5 **Offline-First Sync**
- **Local cache** - AsyncStorage as fast local storage
- **Smart sync** - only upload changes
- **Conflict resolution** - handle offline edits
- **Background sync** - automatic when online

### üìà Success Metrics:
- 90%+ data migration success rate (zero data loss)
- 70%+ users complete auth setup willingly
- 50%+ users actively use cloud sync features
- Performance equal or better than AsyncStorage

### ‚è±Ô∏è Timeline: 2-3 tygodnie

---

## Faza 1: Basic Project Linking (MVP)

### üéØ Cel Fazy:
Podstawowe po≈ÇƒÖczenie projekt√≥w miƒôdzy CalcReno a RenoTimeline z minimalnym przesy≈Çaniem danych.
**WYMAGA: Uko≈Ñczony Etap Przygotowawczy (CalcReno w Supabase)**

### üìã Zakres Prac:

#### 1.1 **Simple Project Export (CalcReno ‚Üí RenoTimeline)**
- **"Utw√≥rz harmonogram w RenoTimeline" button** w CalcReno (dla zalogowanych users)
- **Basic API endpoint** w RenoTimeline przyjmujƒÖcy dane projektu z CalcReno
- **One-way project creation** - projekt powstaje w RenoTimeline na podstawie CalcReno z Supabase
- **Shared user verification** - tylko owner CalcReno project mo≈ºe eksportowaƒá
- **Reference link** w RenoTimeline powr√≥t do projektu ≈∫r√≥d≈Çowego w CalcReno

**CalcReno Implementation Details:**
```typescript
// app/components/ProjectExportButton.tsx - nowy komponent
import { useState } from 'react';
import { Pressable, Text, Alert } from 'react-native';
import { Linking } from 'expo-linking';
import { useAuth } from '../hooks/useAuth';
import type { Project } from '../utils/storage';

interface ProjectExportButtonProps {
  project: Project;
}

export function ProjectExportButton({ project }: ProjectExportButtonProps) {
  const { user } = useAuth();
  const [exporting, setExporting] = useState(false);

  const exportToRenoTimeline = async () => {
    if (!user) {
      Alert.alert('B≈ÇƒÖd', 'Musisz byƒá zalogowany aby eksportowaƒá projekt');
      return;
    }

    setExporting(true);

    try {
      // Przygotowanie danych do eksportu (tylko podstawowe)
      const exportData = {
        calcreno_project_id: project.id,
        name: project.name,
        description: project.description || '',
        start_date: project.startDate,
        end_date: project.endDate,
        estimated_budget: project.totalCost || 0,
        user_email: user.email,
      };

      // Wywo≈Çanie API RenoTimeline
      const response = await fetch('https://renotimeline.app/api/import-from-calcreno', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${user.access_token}`,
        },
        body: JSON.stringify(exportData),
      });

      if (response.ok) {
        const result = await response.json();
        
        Alert.alert(
          'Sukces!', 
          'Projekt zosta≈Ç eksportowany do RenoTimeline',
          [
            { text: 'OK' },
            { 
              text: 'Otw√≥rz RenoTimeline', 
              onPress: () => Linking.openURL(`https://renotimeline.app/project/${result.project_id}`)
            }
          ]
        );
      } else {
        throw new Error('B≈ÇƒÖd eksportu');
      }
    } catch (error) {
      Alert.alert('B≈ÇƒÖd', 'Nie uda≈Ço siƒô eksportowaƒá projektu');
    } finally {
      setExporting(false);
    }
  };

  if (!user) return null;

  return (
    <Pressable
      className="bg-purple-500 rounded p-3 mt-2"
      onPress={exportToRenoTimeline}
      disabled={exporting}
    >
      <Text className="text-white text-center font-semibold">
        {exporting ? 'Eksportowanie...' : 'üìÖ Utw√≥rz harmonogram w RenoTimeline'}
      </Text>
    </Pressable>
  );
}
```

**RenoTimeline API Endpoint (dla referencji):**
```typescript
// RenoTimeline: /api/import-from-calcreno endpoint
app.post('/api/import-from-calcreno', async (req, res) => {
  const { calcreno_project_id, name, description, start_date, end_date, estimated_budget, user_email } = req.body;
  
  // Weryfikacja u≈ºytkownika
  const user = await getUserByEmail(user_email);
  if (!user) return res.status(401).json({ error: 'Unauthorized' });

  // Tworzenie projektu w RenoTimeline
  const project = await createProject({
    name,
    description,
    start_date,
    end_date,
    budget: estimated_budget,
    user_id: user.id,
    source: 'calcreno',
    source_project_id: calcreno_project_id,
  });

  res.json({ project_id: project.id, success: true });
});
```

#### 1.2 **Cross-App Notification API**
```typescript
interface CrossAppNotification {
  project_id: string;
  source_app: 'calcreno' | 'renotimeline';
  event_type: 'budget_updated' | 'project_milestone' | 'cost_alert';
  message: string;
  actionable_link?: string;
  priority: 'low' | 'medium' | 'high';
}
```

#### 1.3 **Basic Event Detection w CalcReno**
- **Budget Changes** - gdy bud≈ºet przekracza X%
- **New Cost Items** - dodanie znaczƒÖcej pozycji
- **Project Completion** - kosztorys oznaczony jako finalny

**CalcReno Implementation Details:**
```typescript
// app/utils/eventDetection.ts - nowy plik
import { supabase } from './supabase';
import type { Project } from './storage';

export class EventDetectionService {
  static async detectBudgetChanges(project: Project, previousTotalCost: number = 0) {
    const currentCost = project.totalCost || 0;
    const changePercentage = previousTotalCost > 0 
      ? ((currentCost - previousTotalCost) / previousTotalCost) * 100 
      : 0;

    // Je≈õli zmiana > 15%, wy≈õlij powiadomienie
    if (Math.abs(changePercentage) > 15) {
      await this.sendCrossAppNotification({
        project_id: project.id,
        source_app: 'calcreno',
        event_type: 'budget_updated',
        message: `Bud≈ºet projektu "${project.name}" ${changePercentage > 0 ? 'wzr√≥s≈Ç' : 'spad≈Ç'} o ${Math.abs(changePercentage).toFixed(1)}%`,
        actionable_link: `calcreno://project/${project.id}`,
        priority: changePercentage > 30 ? 'high' : 'medium',
        metadata: {
          old_cost: previousTotalCost,
          new_cost: currentCost,
          change_percentage: changePercentage,
        }
      });
    }
  }

  static async detectProjectCompletion(project: Project) {
    // Sprawd≈∫ czy wszystkie pomieszczenia majƒÖ kalkulacje
    const completedRooms = project.rooms.filter(room => room.materials?.totalCost);
    const completionRate = (completedRooms.length / project.rooms.length) * 100;

    if (completionRate === 100 && project.status !== 'Zako≈Ñczony') {
      await this.sendCrossAppNotification({
        project_id: project.id,
        source_app: 'calcreno',
        event_type: 'project_milestone',
        message: `Kosztorys projektu "${project.name}" zosta≈Ç uko≈Ñczony! Czas na realizacjƒô.`,
        actionable_link: `renotimeline://project/${project.id}`,
        priority: 'high',
        metadata: {
          total_rooms: project.rooms.length,
          total_cost: project.totalCost,
        }
      });
    }
  }

  static async detectSignificantCostItem(project: Project, roomId: string, newCost: number) {
    const totalBudget = project.totalCost || 0;
    const costPercentage = totalBudget > 0 ? (newCost / totalBudget) * 100 : 0;

    // Je≈õli koszt jednego pomieszczenia > 25% ca≈Çego bud≈ºetu
    if (costPercentage > 25) {
      await this.sendCrossAppNotification({
        project_id: project.id,
        source_app: 'calcreno',
        event_type: 'cost_alert',
        message: `Uwaga! Pomieszczenie w projekcie "${project.name}" poch≈Çania ${costPercentage.toFixed(1)}% ca≈Çego bud≈ºetu`,
        priority: 'medium',
        metadata: {
          room_id: roomId,
          room_cost: newCost,
          cost_percentage: costPercentage,
        }
      });
    }
  }

  private static async sendCrossAppNotification(notification: any) {
    try {
      // 1. Zapisz powiadomienie w Supabase
      await supabase.from('cross_app_notifications').insert(notification);
      
      // 2. Sprawd≈∫ czy projekt ma po≈ÇƒÖczenie z RenoTimeline
      const { data: linkedProject } = await supabase
        .from('project_links')
        .select('renotimeline_project_id')
        .eq('calcreno_project_id', notification.project_id)
        .single();

      if (linkedProject) {
        // 3. Wy≈õlij powiadomienie do RenoTimeline
        await fetch('https://renotimeline.app/api/cross-app-notification', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            ...notification,
            target_project_id: linkedProject.renotimeline_project_id,
          }),
        });
      }
    } catch (error) {
      console.error('Failed to send cross-app notification:', error);
    }
  }
}
```

**Integracja z istniejƒÖcym kodem:**
```typescript
// Modyfikacja w app/hooks/useProjectData.tsx
const handleSaveCalculation = async (calculation: any, selectedRoom: Room | null) => {
  if (!project || !selectedRoom) return;

  const previousTotalCost = project.totalCost || 0;

  const updatedRooms = project.rooms.map((r) =>
    r.id === selectedRoom.id ? { ...r, materials: calculation } : r,
  );

  const totalCost = updatedRooms.reduce(
    (sum, room) => sum + (room.materials?.totalCost || 0),
    0,
  );

  const updatedProject = {
    ...project,
    rooms: updatedRooms,
    totalCost,
  };

  await StorageService.updateProject(updatedProject);
  setProject(updatedProject);

  // NOWE: Wykrywanie wydarze≈Ñ
  await EventDetectionService.detectBudgetChanges(updatedProject, previousTotalCost);
  await EventDetectionService.detectSignificantCostItem(
    updatedProject, 
    selectedRoom.id, 
    calculation.totalCost
  );
  await EventDetectionService.detectProjectCompletion(updatedProject);

  showSuccess("Sukces", "Kalkulacja zosta≈Ça zapisana");
};
```

#### 1.4 **RenoTimeline Notification Center Enhancement**
- **Dedicated CalcReno notifications section**
- **Smart filtering** - tylko relevantne dla u≈ºytkownika
- **Action buttons** - "Zobacz w CalcReno", "Aktualizuj Timeline"

### üìà Success Metrics:
- 50%+ projekt√≥w ma po≈ÇƒÖczenie CalcReno ‚Üî RenoTimeline
- 80%+ users klikajƒÖ w powiadomienia cross-app
- 30%+ users regularnie u≈ºywa obu aplikacji

## Faza 2: Smart Notifications

### üéØ Cel Fazy:
Automatyczne wykrywanie wa≈ºnych wydarze≈Ñ i wysy≈Çanie proaktywnych powiadomie≈Ñ miƒôdzy aplikacjami.

### üìã Zakres Prac:

#### 2.1 **Automatic Event Detection w Obu Aplikacjach**
**RenoTimeline Side:**
- **Progress Updates** - zadanie wyskakuje i zostaƒá uko≈Ñczone
- **Budget Alerts** - projekt przekracza zaplantowane ramy czasowe  
- **Team Changes** - nowy cz≈Çonek zespo≈Çu, zmiany uprawnie≈Ñ

**CalcReno Side:**
- **Cost Variations** - znaczƒÖce zmiany w kosztach materia≈Ç√≥w
- **Budget Revisions** - aktualizacja kosztorysu
- **Supplier Issues** - zmiany cen, dostƒôpno≈õci materia≈Ç√≥w

#### 2.2 **Rich Email Templates**
**From RenoTimeline:**
```html
üìß [RenoTimeline] Aktualizacja projektu "Remont kuchni"

Czƒô≈õƒá: 
Ma≈Çy aktualizacja z projektu "Remont kuchni":
‚úÖ Zadanie "Wymiana instalacji elektrycznej" zosta≈Ço uko≈Ñczone zgodnie z planem!

üîç Sugerujemy sprawdzenie w CalcReno:
- Czy czas pracy by≈Ç zgodny z kalkulacjƒÖ
- Czy nie ma oszczƒôdno≈õci na kosztach robocizny

üîó [Otw√≥rz projekt w CalcReno] [Zobacz szczeg√≥≈Çy w RenoTimeline]

Pozdrowienia,
Zesp√≥≈Ç RenoTimeline
```

#### 2.3 **Cross-App Notification API - Enhanced**
```typescript
interface SmartNotification extends CrossAppNotification {
  suggested_actions: Array<{
    action: string;
    app: 'calcreno' | 'renotimeline';
    url: string;
  }>;
  correlation_data?: {
    budget_impact?: number;
    timeline_impact?: string;
    cost_savings?: number;
  };
}
```

#### 2.4 **In-App Notification Center**
- **Dedicated sections** dla ka≈ºdej aplikacji
- **Smart aggregation** - grouped notifications
- **Action-oriented UI** - clear next steps
- **Bi-directional deep linking**

### üìà Success Metrics:
- 70%+ notification open rate
- 40%+ users take suggested actions
- 25% wzrost user engagement w obu aplikacjach

## Faza 3: AI Integration

### üéØ Cel Fazy:
Wykorzystanie AI do analizy korelacji miƒôdzy kosztami a harmonogramem oraz predykcyjnych insights.

### üìã Zakres Prac:

#### 3.1 **Correlation Engine miƒôdzy Cost Data i Time Data**
**Case vs Budget Analytics:**
- **Czas pracy** by≈Ç zgodny z kalkulacjƒÖ 20%
- **Efficiency Patterns** - teams kt√≥re konsekwentnie przekraczajƒÖ zap≈Çanowane ramki
- **Seasonality** - ceny materia≈Ç√≥w wahajƒÖ siƒô w r√≥≈ºnych porach roku

#### 3.2 **Predictive Notifications**
**"Tej podstawie poprzednich projekt√≥w:**
- **Cost Overrun Alerts** - projekt sk≈Çania siƒô ku przekroczeniu bud≈ºetu
- **Timeline Predictions** - na podstawie postƒôpu mo≈ºe siƒô op√≥≈∫niƒá
- **Efficiency Recommendations** - teams kt√≥re mogu usprawiƒá workflow

#### 3.3 **AI-Powered Cross-App Insights**
**Smart Correlation Engine:**
```typescript
interface AIInsight {
  insight_type: 'cost_efficiency' | 'timeline_prediction' | 'resource_optimization';
  confidence: number; // 0-1
  description: string;
  recommended_actions: string[];
  data_sources: Array<{
    app: string;
    data_type: string;
    time_range: string;
  }>;
}
```

#### 3.4 **Predictive Notifications**
```html
ü§ñ [AI Insight] Projekt "Remont kuchni" - Predykcja koszt√≥w

Na podstawie analizy 50+ podobnych projekt√≥w:
‚ö†Ô∏è Istnieje 78% prawdopodobie≈Ñstwo przekroczenia bud≈ºetu o ~15%

üéØ G≈Ç√≥wne czynniki ryzyka:
- Op√≥≈∫nienia w dostawach materia≈Ç√≥w (aktualnie 3 dni)
- Zesp√≥≈Ç ma tendencjƒô do 20% przekroczenia czasu na instalacje elektryczne

üí° Sugerowane dzia≈Çania:
1. Zabezpiecz dodatkowy bud≈ºet na materia≈Çy (+10%)
2. Rozwa≈º przyspieszenie dostaw kluczowych materia≈Ç√≥w
3. Zaplanuj buffer czasowy dla prac elektrycznych

[Zobacz szczeg√≥≈Çy] [Aktualizuj bud≈ºet w CalcReno] [Dostosuj timeline]
```

### üìà Success Metrics:
- 60%+ accuracy w predykcjach AI
- 50%+ users implementuje AI recommendations
- 20% redukcja cost overruns w projektach z AI insights

## Faza 4: Full Ecosystem

### üéØ Cel Fazy:
Kompletny ecosystem z zaawansowanymi funkcjami wsp√≥≈Çpracy i analityki.

### üìã Zakres Prac:

#### 4.1 **Mobile Notifications przy PWA**
- **Push notifications** na urzƒÖdzenia mobilne
- **Cross-app deep linking** w mobile
- **Offline notification queue** - sync po powrocie online

#### 4.2 **Client Portal i Cross-App Reporting**
- **Unified dashboard** dla klient√≥w z obu aplikacji
- **Integrated progress reports** - costs + timeline w jednym miejscu
- **Predictive project completion** estimates

#### 4.3 **Integration z Zewnƒôtrznymi Tools (Accounting, etc.)**
- **Integracja z e-ksiƒôgowo≈õciƒÖ** (fakturowanie automatyczne)
- **Supplier APIs** - real-time pricing i availability updates
- **Weather API** integration dla outdoor work scheduling

#### 4.4 **Advanced Workflow Automation**
- **Cross-app workflows** - events w jednej aplikacji trigger actions w drugiej
- **Approval processes** spanning both apps
- **Automated reporting** i invoice generation

### üìà Success Metrics:
- 80%+ users aktywnie korzysta z ecosystem features
- 40% wzrost customer satisfaction scores
- 30% redukcja total project completion time

## üõ†Ô∏è Technical Considerations

### Lightweight Integration:
- **Minimal API surface** - tylko basic data + events
- **Event-driven architecture** - notification triggers
- **Async processing** - nie blocking UI operations
- **Graceful degradation** - apps dzia≈ÇajƒÖ independently

### Privacy & Security:
- **Opt-in notifications** - user kontroluje co dostaje
- **Data minimization** - tylko necessary info crosses apps
- **Secure API keys** - encrypted communication
- **GDPR compliance** - easy data deletion path

## ‚úÖ Verdict: Brilliant Simplification

### üéØ Benefits:
- **No podej≈õcie jest znacznie lepsze od complex data sync**
- **Clear value** - immediate benefit dla users
- **Scalable** - easy to add more notification types
- **Low risk** - apps remain independent
- **Business sense** - clean monetization path

### üöÄ Realistic scope - achievable & reasonable timeline
### üíº User value - immediate benefit dla users  
### üéØ Clear implementation path

## üìä G≈Ç√≥wna Integracja: Smart Notifications System

### Concept:
Aplikacje komunikujƒÖ siƒô przez inteligentne powiadomienia. a nie przez kompleksowƒÖ synchronizacjƒô danych.

### Progress Updates:
- **Project Moment Reached** - zadanie 'wykonanie ko≈Ñczy zostaƒá uko≈Ñczone'
- **Budget Alert** - przekroczenie bud≈ºetu 50% realizacji, Czas na update kosztorysu w CalcReno  
- **Milestone Notifications** - faza projektu zako≈Ñczona/rozpoczƒôta

### CalcReno ‚Üí RenoTimeline Notifications:
**Budget Insights:**
- "Bud≈ºet zostanie z≈Ço≈ºenety z 13%. Sprawd≈∫ aktualizacjƒô w harmonogramie" 
- "Nowy kosztorys zmia≈Ço 40% dostƒôpno≈õci. Probuemy zaplanowanie ramice"  
- "Materia≈Çy zaawansowane gotowe. Dodatkowe proce skargu w kalendarz?"

**Budget Alerts:**
- "Dodatkowe nowe zadanie. Wstaw nurt kosztorys w kalendarzu"
- "Projekty pozatywy o 1 tydzie≈Ñ. Sprawd≈∫ wp na otywy kalendarz"

### Future AI:
**AI wysy≈Ça puszczalne kosztorys w RenoTimeline, projekt sk≈Çoni siƒô na 30% przewy≈ºszenia bud≈ºetu-**
"z podstawy podobnych projekt√≥w i historii zespo≈Çu, usuwm dostƒôpno≈õƒá 2 Bunkzenie roboczy..."

### Email-First Notification Strategy

### Dlaczego Email:
- **Universal access** - dzia≈Ça niezale≈ºnie od tego, w kt√≥rej aplikacji jest user
- **Professional** - business users preferujƒÖ email dla wichtigych powiadomie≈Ñ  
- **Rich content** - mo≈ºna za≈ÇƒÖczyƒá screenshots, linki, dane
- **Persistent** - nie znika jak in-app notification

### Architektura Powiadomie≈Ñ

### Notification Bridge Service
Jak dzia≈Ça:
1. **Event Detection** - ka≈ºda aplikacja wykrywa wa≈ºne wydarzenia
2. **Cross-App Notification API** - wysy≈Ça powiadomienie do drugiej aplikacji  
3. **Smart Filtering** - AI decyduje kt√≥re wydarzenia sƒÖ releventne
4. **Multi-Channel Delivery** - email + in-app notification center

### Technical Flow:
**RenoTimeline Side:**
```
üìÖ Task Completed ‚Üí Event Trigger ‚Üí
Check if project has CalcReno link ‚Üí
Generate notification ‚Üí
Send to Notification Bridge ‚Üí
Deliver to CalcReno user
```

**CalcReno Side:**  
```
üí∞ Budget Updated ‚Üí Event Trigger ‚Üí
Check if project linked to RenoTimeline ‚Üí
Generate notification ‚Üí 
Send to Notification Bridge ‚Üí
Deliver to RenoTimeline user
```

### üéØ Next Steps - Implementation Roadmap:

## üöÄ **ETAP 0: CalcReno ‚Üí Supabase (FUNDAMENT) - 2-3 tygodnie**
1. **Install Supabase client** w CalcReno React Native
2. **Setup authentication screens** (login/register) 
3. **Create CalcReno database schema** w istniejƒÖcej Supabase
4. **Build data migration system** AsyncStorage ‚Üí Supabase
5. **Implement offline-first sync** z conflict resolution
6. **Test user migration flow** end-to-end z data preservation

## üîó **ETAP 1: Cross-App Linking (MVP) - 1-2 tygodnie**  
1. **Setup project export API endpoint** w RenoTimeline (przyjmuje dane z CalcReno)
2. **Implement "Export to RenoTimeline" button** w CalcReno (authenticated users only)
3. **Add shared user verification** - owner-only project export
4. **Test basic workflow**: CalcReno project ‚Üí RenoTimeline creation

## üìß **ETAP 2: Smart Notifications (VALUE) - 2-3 tygodnie**
1. **Implement cross-app notification API** w obu aplikacjach (bidirectional notifications)
2. **Implement basic event detection** (budget changes w CalcReno, task completion w RenoTimeline)  
3. **Create email templates** for cross-app notifications
4. **Setup notification center enhancement** w RenoTimeline
5. **Test notification flow** end-to-end: events ‚Üí emails ‚Üí actions

## ü§ñ **ETAP 3+: AI & Advanced Features**
- Correlation engine, predictive insights, advanced workflow automation

### üí° **Kluczowa Insight:**
Bez Etapu 0 (Supabase integration), reszta systemu nie ma fundamentu. Users bez account = no cross-app features.

Dziƒôki takiemu podej≈õciu mo≈ºemy stworzyƒá warto≈õciowy ecosystem bez skomplikowanej synchronizacji danych!

---

## üì± **CalcReno Detailed Implementation Plan**

### üéØ **Current CalcReno State Analysis:**
- **Tech Stack:** React Native + Expo, TypeScript, NativeWind + Tailwind
- **Storage:** AsyncStorage (local only)
- **Architecture:** Component-based with hooks (useProjectData, useToast)
- **Features:** Project management, room geometry, cost calculations, PDF export
- **Dependencies:** 20+ Expo modules, React Native ecosystem

### üîÑ **Required Changes Summary:**

#### **New Dependencies:**
```bash
npm install @supabase/supabase-js expo-linking
```

#### **New File Structure:**
```
app/
  auth/
    AuthScreen.tsx          # Login/register UI
  utils/
    supabase.ts            # Supabase client config
    migration.ts           # AsyncStorage ‚Üí Supabase migration
    eventDetection.ts      # Cross-app event detection
  hooks/
    useAuth.tsx            # Authentication state management
  components/
    MigrationScreen.tsx    # Migration progress UI
    ProjectExportButton.tsx # Export to RenoTimeline
```

#### **Modified Files:**
- `app/_layout.tsx` - Add auth wrapper and migration prompts
- `app/hooks/useProjectData.tsx` - Integrate event detection
- `app/utils/storage.ts` - Hybrid local/cloud storage
- `app/index.tsx` - Add auth prompts and export buttons
- `package.json` - New dependencies

### üèóÔ∏è **Implementation Phases:**

#### **Phase 0.1: Supabase Foundation (2 days)**
1. **Environment Setup**
   - Install Supabase client
   - Configure environment variables
   - Create Supabase client utility

2. **Authentication Integration**
   - Build auth screens (login/register)
   - Implement auth state management
   - Add guest mode support

#### **Phase 0.2: Data Migration (3 days)**
1. **Migration System**
   - Build migration service with progress tracking
   - Implement data preservation safeguards
   - Add rollback capabilities

2. **Storage Layer Upgrade**
   - Modify storage service for hybrid local/cloud
   - Implement offline-first sync
   - Add conflict resolution

#### **Phase 1: Cross-App Features (2 days)**
1. **Project Export**
   - Build export button component
   - Integrate with RenoTimeline API
   - Add deep linking support

2. **Event Detection**
   - Implement budget change detection
   - Add project completion tracking
   - Integrate notification sending

### üéØ **Key Integration Points:**

#### **Data Mapping: CalcReno ‚Üí RenoTimeline**
```typescript
// CalcReno Project ‚Üí RenoTimeline Project
{
  name: project.name,
  description: project.description,
  start_date: project.startDate,
  end_date: project.endDate,
  estimated_budget: project.totalCost,
  source: 'calcreno',
  source_project_id: project.id
}
```

#### **Event Types to Detect:**
- **Budget Changes** (>15% change)
- **Project Completion** (100% rooms calculated)
- **Significant Cost Items** (>25% of total budget)

#### **Notification Triggers:**
- Send to RenoTimeline when budget changes significantly
- Alert when project calculation is complete
- Notify about major cost variances

### üîß **Technical Considerations:**

#### **Offline-First Architecture:**
- AsyncStorage remains primary for speed
- Supabase as source of truth
- Background sync when online
- Conflict resolution for offline edits

#### **User Experience:**
- Seamless migration with progress indicator
- Optional cloud features (guest mode available)
- Deep linking between apps
- Smart notification preferences

#### **Data Security:**
- Shared authentication with RenoTimeline
- User-owned data model
- Encrypted communication
- GDPR compliance ready

### üìä **Success Metrics:**
- **Migration Success:** 90%+ zero data loss
- **User Adoption:** 70%+ complete auth setup
- **Performance:** Equal or better than AsyncStorage
- **Integration Usage:** 50%+ use cross-app features

### ‚ö†Ô∏è **Risk Mitigation:**
- **Gradual rollout** with feature flags
- **Rollback plan** if migration fails
- **Fallback modes** for offline operation
- **Data backup** before any migration

### üéâ **Value Proposition for CalcReno Users:**
- **Cloud backup** of projects (never lose data)
- **Cross-device sync** (phone ‚Üî tablet)
- **Seamless timeline creation** from cost estimates
- **Smart project insights** via RenoTimeline integration
- **Professional workflow** with notifications and exports 